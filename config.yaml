# Grid Strategy Configuration - Topstep 50k Challenge
# TopstepX Trading System
# 
# Challenge Requirements:
# - Profit Target: $3,000
# - Daily Loss Limit: $1,000
# - Trailing Drawdown Limit: $2,000 (from highest balance)
# - Max Position Size: 5 contracts simultaneously
# - Consistency: Best day cannot exceed 50% of total profits

# Trading Instruments
primary_instrument: MES
hedge_instrument: MNQ
capital_equiv: 50000  # 50k challenge starting capital
target_daily_PL: 300  # Conservative daily target (reach $3k in ~10 days)
max_daily_loss: 900    # Safety buffer below $1,000 limit
trailing_drawdown_limit: 1800  # Safety buffer below $2,000 limit

# Grid Parameters
grid_levels_each_side: 3  # Base number of levels each side (used if adaptive_density=false)
atr_window: 14         # ATR on 15m candles by default
atr_multiplier_for_spacing: 0.35  # Slightly wider spacing for challenge (less aggressive)
profit_ticks_per_leg: 0.40  # multiplier of atr_points
hedge_activation_multiplier: 0.8  # Lower threshold for faster hedging (was 1.3)
hedge_profit_protection_enabled: true  # Hedge earlier when profitable
hedge_profit_protection_threshold: 50.0  # Hedge when unrealized P&L > $50 and price moves against

# Enhanced Grid Features
adaptive_density: true  # Enable adaptive grid density based on volatility
min_levels_each_side: 2  # Minimum levels when volatility is high
max_levels_each_side: 5  # Maximum levels when volatility is low
base_levels_each_side: 3  # Base levels for adaptive calculation

# Multi-Timeframe Alignment
enable_multi_timeframe: true  # Enable support/resistance alignment from higher timeframes
mtf_timeframes: ["1h", "4h"]  # Higher timeframes to analyze
mtf_lookback_1h: 50  # Number of 1h candles to analyze
mtf_lookback_4h: 30  # Number of 4h candles to analyze
mtf_alignment_threshold: 0.002  # Max distance to align grid (0.2% of price)

# Order Flow Integration
enable_order_flow: true  # Enable order flow analysis for grid adjustment
order_flow_lookback: 20  # Number of snapshots to keep for order flow
order_flow_imbalance_threshold: 0.3  # Threshold for significant imbalance
order_flow_volume_threshold: 0.1  # Minimum volume threshold to avoid price levels

# Volatility & Sizing
volatility_window: 100  # for sizer and corr calc
sizer_R_per_trade: 25  # Reduced risk per trade ($100 vs $150) for challenge safety
max_net_notional: 15000000  # Updated: With correct multiplier (5x), 5 MES @ $7000 = $175k notional. Set to $200k for headroom.
max_position_size: 5    # Hard limit: 5 contracts max (challenge requirement)

# Timing
recalc_interval_seconds: 60  # Slightly less frequent recalc for challenge
session_close_safety_margin_minutes: 10  # More conservative margin (challenge safety)
max_price_staleness_seconds: 5  # Skip order/hedge actions if market price is stale

# TopstepX API Configuration
api_base_url: https://api.topstepx.com
user_hub_url: https://rtc.topstepx.com/hubs/user
market_hub_url: https://rtc.topstepx.com/hubs/market

# Risk Management
hedge_ratio_min: 0.4   # Lower minimum for challenge (less aggressive)
hedge_ratio_max: 1.0    # Lower maximum for challenge (safer)
correlation_threshold: 0.60  # Higher threshold (more conservative)
max_hedge_contracts_multiplier: 0.5  # Conservative hedge sizing (50% of primary max)
hedge_min_exposure_dollars: 300  # Minimum exposure before hedging
hedge_unwind_multiplier: 0.5  # Unwind hedge when price is within 0.5x spacing
hedge_cooldown_seconds: 60  # Reduced cooldown for faster response (was 120)
hedge_fraction_of_primary: 0.7  # More aggressive hedge (70% of target, was 50%)
hedge_max_fraction_of_primary: 1.0  # Cap hedge at 100% of primary size
hedge_trend_threshold: 2.0  # Trend strength in ATRs to reduce hedging
hedge_trend_reduce_factor: 0.3  # Reduce hedge size in strong trends
trend_window: 20  # Window for trend strength calculation

# Consistency Target (challenge requirement)
# Best day cannot exceed 50% of total profits
# If total profit = $3,000, best day max = $1,500
consistency_max_daily_profit_pct: 0.50  # 50% of total profit target
consistency_enabled: true

# Observability
metrics_port: 8000
log_level: INFO

# Trading Mode - CRITICAL: Set to false for live challenge account
dry_run: false  # MUST be false for live challenge trading

# Account Selection - CRITICAL: Set to false to use LIVE challenge account
prefer_practice_account: false  # MUST be false for 50k challenge
account_id: null  # Optional: specify your 50k challenge account ID directly

# Challenge-Specific Safety Features
enable_consistency_check: true  # Monitor best day vs total profit
enable_position_size_limit: true  # Enforce 5-contract maximum
enable_aggressive_risk_checks: true  # More frequent risk monitoring

